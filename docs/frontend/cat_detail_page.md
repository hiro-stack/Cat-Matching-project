# 猫詳細ページ仕様書

## 1. ページ概要

**個別の保護猫の詳細情報を閲覧し、里親応募を行うページ**です。
写真ギャラリーで猫の魅力を伝え、性格や健康状態などの重要情報を提供します。
属性（里親/保護団体）によって、表示されるアクションボタンが変化します。

---

## 2. 画面レイアウト・コンテンツ配置

### 2.1 ヘッダーナビゲーション

- **戻るボタン**: 「← 一覧に戻る」リンクを左上に配置。

### 2.2 メインコンテンツ (左右2カラムレイアウト)

#### 左カラム: メディアギャラリー

- **メイン画像**: 現在選択中の画像を大きく表示。アスペクト比を維持し見やすく。
- **サムネイルリスト**:
  - 登録されている全画像を横スクロールで表示。
  - クリックするとメイン画像が切り替わる。
  - 現在選択中の画像は枠線で強調。

#### 右カラム: 情報 & アクション

- **基本ヘッダー**:
  - 名前（特大サイズ）、年齢、性別。
  - ステータスバッジ（募集中など）。
- **詳細情報カード**:
  - **特徴・性格**: フリーテキストの説明文。
  - **スペック表**:
    - 性格、健康状態、ワクチン接種状況、去勢・避妊有無。
- **保護団体情報**:
  - 保護している団体の名前を表示。

### 2.3 アクションエリア (右カラム下部)

ユーザーの属性により出し分けを行う。

1.  **里親ユーザー (Adopter) & ゲスト**:
    - **応募フォーム**:
      - 「募集中」ステータスの場合のみ表示。
      - 保護団体への初回メッセージ入力欄 (`TextArea`)。
      - 「応募する」ボタン。
    - **非ログイン時**:
      - ログインページへの誘導ボタンを表示。
    - **応募完了後**:
      - 完了メッセージと「応募履歴へ」のリンクを表示。

2.  **保護団体ユーザー (Shelter) - 飼い主**:
    - **編集ボタン**:
      - 「情報を編集する」ボタンを表示（編集ページへの遷移）。
    - 応募フォームは非表示。

---

## 3. 実装詳細

### ファイル

- `frontend/src/app/cats/[id]/page.tsx`

### 技術的実装

1.  **データ取得**:
    - `useSWR` を使用し、URLパラメータの `id` を用いて `/api/cats/{id}/` から詳細情報を取得。
    - データロード中はスピナーを表示。

2.  **メディア切替**:
    - ローカルState (`activeMedia`) で現在表示中の画像URLを管理。デフォルトは `primary_image`。

3.  **権限ハンドリング (`useAuth`)**:
    - `user.user_type` と `cat.shelter_id` を比較。
    - `isOwner`: 自身が登録した猫の場合、編集権限を付与。
    - `canApply`: 里親ユーザーかつ、自身の登録猫でない場合にフラグを立てる。

4.  **応募機能 (`applicationsService`)**:
    - 「応募する」クリックで `createApplication` APIを実行。
    - 成功時はローカルState (`applySuccess`) を更新し、フォームを完了UIに差し替える。
